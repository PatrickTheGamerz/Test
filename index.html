<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Scratchâ€‘like C++ Builder</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #1e1e2e;
    color: #cdd6f4;
    display: flex;
    height: 100vh;
    overflow: hidden;
    user-select: none;
  }

  #sidebar {
    width: 260px;
    background: #11111b;
    border-right: 2px solid #313244;
    padding: 12px;
    overflow-y: auto;
  }

  #sidebar h2 {
    margin-top: 0;
    font-size: 18px;
    color: #89b4fa;
  }

  .category h3 {
    margin: 10px 0 4px;
    font-size: 14px;
    color: #b4befe;
  }

  .block {
    background: linear-gradient(135deg, #45475a, #585b70);
    border-radius: 10px;
    padding: 8px 10px;
    margin: 6px 0;
    cursor: grab;
    font-size: 13px;
    color: #f5e0dc;
    box-shadow: 0 3px 6px #0005;
    user-select: none;
    transition: transform .1s;
  }

  .block:hover {
    transform: scale(1.03);
  }

  .block input, .block select {
    font-size: 12px;
    width: 60px;
    margin-left: 4px;
  }

  #workspace {
    flex: 1;
    display: flex;
    padding: 10px;
    gap: 10px;
  }

  #scriptArea {
    flex: 1;
    background: #181825;
    border-radius: 10px;
    padding: 10px;
    overflow-y: auto;
    border: 1px solid #313244;
    position: relative;
  }

  #scriptArea h3 {
    margin-top: 0;
    color: #89b4fa;
  }

  .script-block {
    background: linear-gradient(135deg, #313244, #45475a);
    border-radius: 10px;
    padding: 8px 10px;
    margin: 6px 0;
    font-size: 13px;
    color: #f5e0dc;
    box-shadow: 0 3px 6px #0005;
    position: absolute;
    cursor: grab;
  }

  .remove-btn {
    position: absolute;
    right: 6px;
    top: 6px;
    background: #f38ba8;
    border: none;
    border-radius: 4px;
    font-size: 10px;
    padding: 2px 5px;
    cursor: pointer;
  }

  #rightPane {
    width: 380px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  #cppCode, #output {
    flex: 1;
    background: #11111b;
    border-radius: 10px;
    padding: 10px;
    border: 1px solid #313244;
    font-family: "JetBrains Mono", monospace;
    font-size: 12px;
    white-space: pre-wrap;
    overflow-y: auto;
    pointer-events: none;
  }

  #controls {
    padding: 10px;
    background: #11111b;
    border-top: 2px solid #313244;
    display: flex;
    gap: 10px;
    justify-content: center;
  }

  .btn {
    background: #89b4fa;
    border: none;
    border-radius: 6px;
    padding: 8px 16px;
    cursor: pointer;
    font-size: 14px;
    color: #11111b;
    font-weight: bold;
  }

  .btn:hover {
    background: #b4befe;
  }
</style>
</head>

<body>

<div id="sidebar">
  <h2>Blocks</h2>

  <div class="category">
    <h3>Control</h3>
    <div class="block" draggable="true" data-type="repeat">repeat <input type="number" value="5"> times</div>
    <div class="block" draggable="true" data-type="if">if (<input type="text" value="x>0">)</div>
    <div class="block" draggable="true" data-type="end">end</div>
  </div>

  <div class="category">
    <h3>Motion</h3>
    <div class="block" draggable="true" data-type="setx">set x to <input type="number" value="0"></div>
    <div class="block" draggable="true" data-type="sety">set y to <input type="number" value="0"></div>
    <div class="block" draggable="true" data-type="changex">change x by <input type="number" value="10"></div>
    <div class="block" draggable="true" data-type="changey">change y by <input type="number" value="10"></div>
  </div>

  <div class="category">
    <h3>Looks</h3>
    <div class="block" draggable="true" data-type="print">print "<input type="text" value="hello">"</div>
    <div class="block" draggable="true" data-type="printpos">print position</div>
  </div>

  <div class="category">
    <h3>Variables</h3>
    <div class="block" draggable="true" data-type="setvar">set <input type="text" value="a"> to <input type="number" value="0"></div>
    <div class="block" draggable="true" data-type="changevar">change <input type="text" value="a"> by <input type="number" value="1"></div>
    <div class="block" draggable="true" data-type="printvar">print var <input type="text" value="a"></div>
  </div>

  <div class="category">
    <h3>Input</h3>
    <div class="block" draggable="true" data-type="input">ask "<input type="text" value="Your name?">" store in <input type="text" value="name"></div>
  </div>

  <div class="category">
    <h3>Math</h3>
    <div class="block" draggable="true" data-type="math">set <input type="text" value="result"> to <input type="text" value="a+5"></div>
  </div>
</div>

<div id="workspace">
  <div id="scriptArea">
    <h3>Script</h3>
  </div>

  <div id="rightPane">
    <div id="cppCode"></div>
    <div id="output"></div>
  </div>
</div>

<div id="controls">
  <button class="btn" id="runBtn">RUN PROGRAM</button>
  <button class="btn" id="clearBtn">CLEAR SCRIPT</button>
</div>

<script>
  const scriptArea = document.getElementById("scriptArea");
  const cppCodeEl = document.getElementById("cppCode");
  const outputEl = document.getElementById("output");

  let scriptBlocks = [];
  let dragged = null;

  document.addEventListener("dragstart", e => {
    if (e.target.classList.contains("block")) dragged = e.target;
  });

  scriptArea.addEventListener("dragover", e => e.preventDefault());

  scriptArea.addEventListener("drop", e => {
    e.preventDefault();
    if (!dragged) return;
    createScriptBlock(dragged, e.offsetX, e.offsetY);
    dragged = null;
  });

  function createScriptBlock(block, x, y) {
    const type = block.dataset.type;
    const clone = document.createElement("div");
    clone.className = "script-block";
    clone.dataset.type = type;
    clone.innerHTML = block.innerHTML;
    clone.style.left = x + "px";
    clone.style.top = y + "px";

    const remove = document.createElement("button");
    remove.className = "remove-btn";
    remove.textContent = "x";
    remove.onclick = () => {
      scriptArea.removeChild(clone);
      scriptBlocks = scriptBlocks.filter(b => b.el !== clone);
      updateCpp();
    };
    clone.appendChild(remove);

    enableDrag(clone);

    scriptArea.appendChild(clone);
    scriptBlocks.push({ el: clone, type, getValues: () => readValues(clone) });
    updateCpp();
  }

  function enableDrag(el) {
    let offsetX, offsetY;

    el.addEventListener("mousedown", e => {
      if (e.target.classList.contains("remove-btn")) return;
      offsetX = e.offsetX;
      offsetY = e.offsetY;

      function move(ev) {
        el.style.left = ev.pageX - scriptArea.offsetLeft - offsetX + "px";
        el.style.top = ev.pageY - scriptArea.offsetTop - offsetY + "px";
      }

      function stop() {
        document.removeEventListener("mousemove", move);
        document.removeEventListener("mouseup", stop);
      }

      document.addEventListener("mousemove", move);
      document.addEventListener("mouseup", stop);
    });
  }

  function readValues(el) {
    return [...el.querySelectorAll("input, select")].map(x => x.value);
  }

  function updateCpp() {
    cppCodeEl.textContent = generateCpp();
  }

  function generateCpp() {
    let code = "";
    code += "#include <iostream>\n#include <string>\nusing namespace std;\n\nint main(){\n";
    code += "    int x=0, y=0;\n";
    let vars = new Set();

    scriptBlocks.forEach(b => {
      if (["setvar","changevar","printvar","input","math"].includes(b.type)) {
        vars.add(b.getValues()[0]);
      }
    });

    vars.forEach(v => code += `    string ${v};\n`);

    let indent = 1;
    const tab = () => "    ".repeat(indent);

    scriptBlocks.forEach(b => {
      const t = b.type;
      const v = b.getValues();

      if (t === "setx") code += tab() + `x=${v[0]};\n`;
      if (t === "sety") code += tab() + `y=${v[0]};\n`;
      if (t === "changex") code += tab() + `x+=${v[0]};\n`;
      if (t === "changey") code += tab() + `y+=${v[0]};\n`;

      if (t === "print") code += tab() + `cout<<"${v[0]}"<<endl;\n`;
      if (t === "printpos") code += tab() + `cout<<"x="<<x<<", y="<<y<<endl;\n`;

      if (t === "setvar") code += tab() + `${v[0]}="${v[1]}";\n`;
      if (t === "changevar") code += tab() + `${v[0]}=to_string(stoi(${v[0]})+${v[1]});\n`;
      if (t === "printvar") code += tab() + `cout<<"${v[0]}="<<${v[0]}<<endl;\n`;

      if (t === "input") {
        code += tab() + `cout<<"${v[0]}";\n`;
        code += tab() + `cin>>${v[1]};\n`;
      }

      if (t === "math") {
        code += tab() + `${v[0]}=to_string(${v[1]});\n`;
      }

      if (t === "repeat") {
        code += tab() + `for(int i=0;i<${v[0]};i++){\n`;
        indent++;
      }

      if (t === "if") {
        code += tab() + `if(${v[0]}){\n`;
        indent++;
      }

      if (t === "end") {
        indent--;
        code += tab() + "}\n";
      }
    });

    code += "    return 0;\n}\n";
    return code;
  }

  function runScript() {
    outputEl.textContent = "(simulation disabled for now)";
  }

  document.getElementById("runBtn").onclick = () => {
    updateCpp();
    runScript();
  };

  document.getElementById("clearBtn").onclick = () => {
    scriptBlocks = [];
    scriptArea.querySelectorAll(".script-block").forEach(b => b.remove());
    updateCpp();
    outputEl.textContent = "";
  };

  updateCpp();
</script>

</body>
</html>
