<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scratchâ€‘like C++ Blocks (Draggable, Improved UI)</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #1e1e2e;
    color: #cdd6f4;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  /* SIDEBAR */
  #sidebar {
    width: 260px;
    background: #11111b;
    border-right: 2px solid #313244;
    padding: 12px;
    overflow-y: auto;
  }
  #sidebar h2 {
    margin-top: 0;
    font-size: 18px;
    color: #89b4fa;
  }
  .category h3 {
    margin: 10px 0 4px;
    font-size: 14px;
    color: #b4befe;
  }

  /* BLOCKS */
  .block {
    background: linear-gradient(135deg, #45475a, #585b70);
    border-radius: 10px;
    padding: 8px 10px;
    margin: 6px 0;
    cursor: grab;
    font-size: 13px;
    color: #f5e0dc;
    box-shadow: 0 3px 6px #0005;
    user-select: none;
    transition: transform .1s;
  }
  .block:hover {
    transform: scale(1.03);
  }
  .block input, .block select {
    font-size: 12px;
    width: 60px;
    margin-left: 4px;
  }

  /* WORKSPACE */
  #workspace {
    flex: 1;
    display: flex;
    padding: 10px;
    gap: 10px;
  }

  #scriptArea {
    flex: 1;
    background: #181825;
    border-radius: 10px;
    padding: 10px;
    overflow-y: auto;
    border: 1px solid #313244;
  }
  #scriptArea h3 {
    margin-top: 0;
    color: #89b4fa;
  }

  .script-block {
    background: linear-gradient(135deg, #313244, #45475a);
    border-radius: 10px;
    padding: 8px 10px;
    margin: 6px 0;
    font-size: 13px;
    color: #f5e0dc;
    box-shadow: 0 3px 6px #0005;
    position: relative;
    cursor: grab;
  }

  .remove-btn {
    position: absolute;
    right: 6px;
    top: 6px;
    background: #f38ba8;
    border: none;
    border-radius: 4px;
    font-size: 10px;
    padding: 2px 5px;
    cursor: pointer;
  }

  /* RIGHT PANEL */
  #rightPane {
    width: 380px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  #cppCode, #output {
    flex: 1;
    background: #11111b;
    border-radius: 10px;
    padding: 10px;
    border: 1px solid #313244;
    font-family: "JetBrains Mono", monospace;
    font-size: 12px;
    white-space: pre-wrap;
    overflow-y: auto;
  }

  #controls {
    padding: 10px;
    background: #11111b;
    border-top: 2px solid #313244;
    display: flex;
    gap: 10px;
  }

  button {
    background: #89b4fa;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 13px;
    color: #11111b;
  }
  button:hover {
    background: #b4befe;
  }
</style>
</head>

<body>

<div id="sidebar">
  <h2>Blocks</h2>

  <div class="category">
    <h3>Control</h3>
    <div class="block" draggable="true" data-type="repeat">repeat <input type="number" value="5"> times</div>
    <div class="block" draggable="true" data-type="if">if (<select>
      <option value="x&lt;0">x &lt; 0</option>
      <option value="x&gt;0">x &gt; 0</option>
      <option value="x==0">x == 0</option>
    </select>)</div>
    <div class="block" draggable="true" data-type="end">end</div>
  </div>

  <div class="category">
    <h3>Motion</h3>
    <div class="block" draggable="true" data-type="setx">set x to <input type="number" value="0"></div>
    <div class="block" draggable="true" data-type="sety">set y to <input type="number" value="0"></div>
    <div class="block" draggable="true" data-type="changex">change x by <input type="number" value="10"></div>
    <div class="block" draggable="true" data-type="changey">change y by <input type="number" value="10"></div>
  </div>

  <div class="category">
    <h3>Looks</h3>
    <div class="block" draggable="true" data-type="print">print "<input type="text" value="hello">"</div>
    <div class="block" draggable="true" data-type="printpos">print position</div>
  </div>

  <div class="category">
    <h3>Variables</h3>
    <div class="block" draggable="true" data-type="setvar">set <input type="text" value="a"> to <input type="number" value="0"></div>
    <div class="block" draggable="true" data-type="changevar">change <input type="text" value="a"> by <input type="number" value="1"></div>
    <div class="block" draggable="true" data-type="printvar">print var <input type="text" value="a"></div>
  </div>
</div>

<div id="workspace">
  <div id="scriptArea">
    <h3>Script</h3>
  </div>

  <div id="rightPane">
    <div id="cppCode"></div>
    <div id="output"></div>
  </div>
</div>

<div id="controls">
  <button id="runBtn">Run</button>
  <button id="clearBtn">Clear</button>
</div>

<script>
  const scriptArea = document.getElementById("scriptArea");
  const cppCodeEl = document.getElementById("cppCode");
  const outputEl = document.getElementById("output");

  let scriptBlocks = [];

  /* DRAGGING */
  let dragged = null;

  document.addEventListener("dragstart", e => {
    if (e.target.classList.contains("block")) {
      dragged = e.target;
    }
  });

  scriptArea.addEventListener("dragover", e => {
    e.preventDefault();
  });

  scriptArea.addEventListener("drop", e => {
    e.preventDefault();
    if (!dragged) return;
    addScriptBlock(dragged);
    dragged = null;
  });

  function addScriptBlock(block) {
    const type = block.dataset.type;
    const clone = document.createElement("div");
    clone.className = "script-block";
    clone.dataset.type = type;
    clone.innerHTML = block.innerHTML;

    const remove = document.createElement("button");
    remove.className = "remove-btn";
    remove.textContent = "x";
    remove.onclick = () => {
      scriptArea.removeChild(clone);
      scriptBlocks = scriptBlocks.filter(b => b.el !== clone);
      updateCpp();
    };
    clone.appendChild(remove);

    scriptArea.appendChild(clone);
    scriptBlocks.push({ el: clone, type, getValues: () => readValues(clone) });
    updateCpp();
  }

  function readValues(el) {
    return [...el.querySelectorAll("input, select")].map(x => x.value);
  }

  function updateCpp() {
    cppCodeEl.textContent = generateCpp();
  }

  function generateCpp() {
    let code = "";
    code += "#include <iostream>\nusing namespace std;\n\nint main(){\n";
    code += "    int x=0, y=0;\n";

    let vars = new Set();
    scriptBlocks.forEach(b => {
      if (["setvar","changevar","printvar"].includes(b.type)) {
        vars.add(b.getValues()[0]);
      }
    });
    vars.forEach(v => code += `    int ${v}=0;\n`);

    let indent = 1;
    const tab = () => "    ".repeat(indent);

    scriptBlocks.forEach(b => {
      const t = b.type;
      const v = b.getValues();

      if (t === "setx") code += tab() + `x=${v[0]};\n`;
      if (t === "sety") code += tab() + `y=${v[0]};\n`;
      if (t === "changex") code += tab() + `x+=${v[0]};\n`;
      if (t === "changey") code += tab() + `y+=${v[0]};\n`;

      if (t === "print") code += tab() + `cout<<"${v[0]}"<<endl;\n`;
      if (t === "printpos") code += tab() + `cout<<"x="<<x<<", y="<<y<<endl;\n`;

      if (t === "setvar") code += tab() + `${v[0]}=${v[1]};\n`;
      if (t === "changevar") code += tab() + `${v[0]}+=${v[1]};\n`;
      if (t === "printvar") code += tab() + `cout<<"${v[0]}="<<${v[0]}<<endl;\n`;

      if (t === "repeat") {
        code += tab() + `for(int i=0;i<${v[0]};i++){\n`;
        indent++;
      }
      if (t === "if") {
        code += tab() + `if(${v[0]}){\n`;
        indent++;
      }
      if (t === "end") {
        indent--;
        code += tab() + "}\n";
      }
    });

    code += "    return 0;\n}\n";
    return code;
  }

  function runScript() {
    let x = 0, y = 0;
    let vars = {};
    let out = "";

    function println(s){ out += s + "\n"; }

    function exec(blocks, start=0, end=blocks.length) {
      let i = start;
      while (i < end) {
        const b = blocks[i];
        const t = b.type;
        const v = b.getValues();

        if (t === "setx") x = Number(v[0]);
        if (t === "sety") y = Number(v[0]);
        if (t === "changex") x += Number(v[0]);
        if (t === "changey") y += Number(v[0]);

        if (t === "print") println(v[0]);
        if (t === "printpos") println(`x=${x}, y=${y}`);

        if (t === "setvar") vars[v[0]] = Number(v[1]);
        if (t === "changevar") vars[v[0]] = (vars[v[0]]||0) + Number(v[1]);
        if (t === "printvar") println(`${v[0]}=${vars[v[0]]||0}`);

        if (t === "repeat") {
          let depth = 0, j = i+1;
          for (; j < end; j++) {
            if (["repeat","if"].includes(blocks[j].type)) depth++;
            if (blocks[j].type === "end") {
              if (depth === 0) break;
              depth--;
            }
          }
          for (let k=0;k<Number(v[0]);k++) exec(blocks, i+1, j);
          i = j;
        }

        if (t === "if") {
          let depth = 0, j = i+1;
          for (; j < end; j++) {
            if (["repeat","if"].includes(blocks[j].type)) depth++;
            if (blocks[j].type === "end") {
              if (depth === 0) break;
              depth--;
            }
          }
          let cond = false;
          try {
            cond = eval(v[0].replace(/x/g,x).replace(/y/g,y));
          } catch {}
          if (cond) exec(blocks, i+1, j);
          i = j;
        }

        i++;
      }
    }

    exec(scriptBlocks);
    outputEl.textContent = out || "(no output)";
  }

  document.getElementById("runBtn").onclick = () => {
    updateCpp();
    runScript();
  };

  document.getElementById("clearBtn").onclick = () => {
    scriptBlocks = [];
    scriptArea.querySelectorAll(".script-block").forEach(b => b.remove());
    updateCpp();
    outputEl.textContent = "";
  };

  updateCpp();
</script>

</body>
</html>
